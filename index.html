<!DOCTYPE html>
<html lang="mg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚úàÔ∏è AVIATOR MAX ¬∑ HISTORIQUE SUPPRIMABLE</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #0a0c18;
            font-family: 'Inter', 'Segoe UI', system-ui, sans-serif;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 16px;
            background-image: radial-gradient(circle at 70% 20%, #1e2548 0%, #03050e 90%);
        }

        .dashboard {
            max-width: 1300px;
            width: 100%;
            background: rgba(12, 16, 33, 0.9);
            backdrop-filter: blur(12px);
            border: 1px solid #e94560;
            border-radius: 48px;
            padding: 30px 28px;
            box-shadow: 0 30px 45px -15px black, 0 0 0 2px rgba(233, 69, 96, 0.3) inset;
        }

        /* header */
        .head {
            display: flex;
 align-items: center;
            justify-content: space-between;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 15px;
        }
        .title h1 {
            font-size: 2.8rem;
            font-weight: 800;
            background: linear-gradient(135deg, #fff, #ffb156, #ff4d6d);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            letter-spacing: 1.5px;
            text-transform: uppercase;
            filter: drop-shadow(0 0 10px #e94560);
        }
        .title p {
            color: #99a2c7;
            font-size: 1rem;
        }
        .max-badge {
            background: linear-gradient(145deg, #e94560, #f3722c);
            padding: 16px 30px;
            border-radius: 100px;
            font-weight: 900;
            font-size: 2.2rem;
            color: #0a0f20;
            box-shadow: 0 0 30px #ff4d6d;
            transform: rotate(2deg);
            border: 2px solid gold;
        }

        /* grille param√®tres */
        .param-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(170px, 1fr));
            gap: 16px;
            margin: 32px 0;
        }
        .param-card {
            background: #141b36;
            border: 1px solid #33406e;
            border-radius: 30px;
            padding: 16px 20px;
            transition: all 0.2s;
        }
        .param-card:focus-within {
            border-color: #e94560;
            box-shadow: 0 0 0 3px rgba(233, 69, 96, 0.4);
        }
        .param-card label {
            display: flex;
            gap: 8px;
            align-items: center;
            color: #b1bceb;
            font-weight: 600;
            font-size: 0.85rem;
            text-transform: uppercase;
            margin-bottom: 8px;
        }
        .param-card input {
            background: transparent;
            border: none;
            width: 100%;
            font-size: 1.8rem;
            font-weight: 700;
            color: #ffffff;
            outline: none;
            font-family: 'Courier New', monospace;
        }
        .param-card input::placeholder {
            color: #35426b;
            font-size: 1.2rem;
        }

        /* boutons principaux */
        .button-group {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 24px;
            margin: 35px 0 30px;
        }
        .btn {
            border: none;
            padding: 18px 50px;
            border-radius: 60px;
            font-size: 1.3rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 2px;
            cursor: pointer;
            transition: 0.2s;
            box-shadow: 0 8px 0 #0f0f1f;
            display: inline-flex;
            align-items: center;
            gap: 12px;
            border: 1px solid rgba(255,255,220,0.3);
        }
        .btn-calc {
            background: linear-gradient(145deg, #e94560, #c13b5c);
            color: white;
        }
        .btn-calc:hover {
            transform: translateY(-5px);
            box-shadow: 0 13px 0 #7a1f34, 0 0 30px #ff5277;
        }
        .btn-save {
            background: linear-gradient(145deg, #1d5e7a, #1b8c7c);
            color: white;
        }
        .btn-save:hover {
            transform: translateY(-5px);
            box-shadow: 0 13px 0 #0d3b47, 0 0 30px #2aa38f;
        }

        /* affichage pr√©diction */
        .prediction-block {
            background: #0d1330;
            border-radius: 60px;
            padding: 30px 30px;
            margin: 25px 0 35px;
            border: 2px solid;
            border-color: #e94560 #e94560 #f4c542 #f4c542;
            position: relative;
            overflow: hidden;
        }
        .prediction-block::after {
            content: "‚úàÔ∏è";
            position: absolute;
            bottom: -20px;
            right: 10px;
            font-size: 9rem;
            opacity: 0.08;
            transform: rotate(-10deg);
        }
        .prediction-label {
            color: #b7c1f0;
            font-size: 1.3rem;
            letter-spacing: 3px;
        }
        .prediction-time {
            font-family: 'Courier New', monospace;
            font-size: 6rem;
            font-weight: 900;
            line-height: 1;
            color: #ffe074;
            text-shadow: 0 0 30px #ffb347, 0 0 60px #e94560;
            margin: 5px 0 5px;
            word-break: break-word;
        }
        .coeff-large {
            background: #f5c542;
            color: #101624;
            font-weight: 900;
            font-size: 2.5rem;
            padding: 8px 40px;
            border-radius: 60px;
            display: inline-block;
            box-shadow: 0 0 25px gold;
        }
        .calc-desc {
            color: #98a5de;
            margin-top: 20px;
            font-size: 1rem;
            border-top: 1px dashed #31467a;
            padding-top: 20px;
        }

        /* historique header + bouton effacer */
        .history-header {
            display: flex;
            align-items: center;
            gap: 18px;
            flex-wrap: wrap;
            margin: 20px 0 20px;
        }
        .history-header h2 {
            color: white;
            font-size: 2rem;
            font-weight: 600;
        }
        .counter-badge {
            background: #e94560;
            padding: 8px 22px;
            border-radius: 50px;
            font-weight: 800;
            font-size: 1.5rem;
            color: white;
        }
        .delete-all-btn {
            background: rgba(220, 60, 80, 0.15);
            border: 2px solid #e94560;
            color: #ffb0b0;
            padding: 12px 32px;
            border-radius: 40px;
            font-weight: 700;
            font-size: 1.2rem;
            cursor: pointer;
            transition: 0.2s;
            margin-left: auto;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .delete-all-btn:hover {
            background: #e94560;
            color: white;
            border-color: white;
        }

        /* grille historique */
        .history-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
            gap: 20px;
            max-height: 460px;
            overflow-y: auto;
            padding: 10px 6px;
        }
        .history-card {
            background: #131b3a;
            border-radius: 28px;
            padding: 18px;
            border-left: 8px solid #e94560;
            transition: 0.2s;
            box-shadow: 0 8px 0 #0b1023;
            position: relative;
        }
        .history-card:hover {
            transform: scale(1.02);
            border-left-color: #ffcd6b;
        }
        .history-card .pred-hour {
            font-family: monospace;
            font-size: 2rem;
            font-weight: 800;
            color: #ffe180;
            line-height: 1.2;
        }
        .history-detail {
            display: flex;
            flex-wrap: wrap;
            gap: 12px 15px;
            color: #b2bfee;
            margin: 12px 0 8px;
            font-size: 0.9rem;
        }
        .history-coeff {
            background: #2b3c6b;
            padding: 5px 15px;
            border-radius: 30px;
            font-weight: 700;
            color: gold;
            display: inline-block;
        }
        .history-date {
            color: #56659e;
            font-size: 0.7rem;
            margin-top: 8px;
        }
        /* bouton supprimer individuel */
        .delete-one {
            position: absolute;
            top: 12px;
            right: 15px;
            background: rgba(0,0,0,0.4);
            border: none;
            color: #ff8a8a;
            font-size: 1.4rem;
            cursor: pointer;
            width: 32px;
            height: 32px;
            border-radius: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            transition: 0.2s;
        }
        .delete-one:hover {
            background: #e94560;
            color: white;
        }

        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #111832; border-radius: 10px; }
        ::-webkit-scrollbar-thumb { background: #e94560; border-radius: 10px; }
    </style>
</head>
<body>
<div class="dashboard">

    <!-- HEADER -->
    <div class="head">
        <div class="title">
            <h1>‚úàÔ∏è AVIATOR MAX</h1>
            <p>prediction + historique supprimable</p>
        </div>
        <div class="max-badge">MAX</div>
    </div>

    <!-- PARAM√àTRES (5 inputs) -->
    <div class="param-grid">
        <div class="param-card">
            <label>üî¢ PREMIER HEX</label>
            <input type="text" id="hexFirst" maxlength="2" placeholder="ex: 8" value="8">
        </div>
        <div class="param-card">
            <label>üî¢ PREMIER DEC</label>
            <input type="text" id="decFirst" maxlength="1" placeholder="ex: 5" value="5">
        </div>
        <div class="param-card">
            <label>‚è∞ HEURE TOUR</label>
            <input type="text" id="tourTime" placeholder="HH:MM" value="09:30">
        </div>
        <div class="param-card">
            <label>‚è±Ô∏è DERNIER HEX</label>
            <input type="text" id="hexLast" maxlength="2" placeholder="ex: 6" value="6">
        </div>
        <div class="param-card">
            <label>üé∞ COEFF (x)</label>
            <input type="text" id="coeff" placeholder="ex: 5.06" value="5.06">
        </div>
    </div>

    <!-- BOUTONS CALCUL & SAUVEGARDE -->
    <div class="button-group">
        <button class="btn btn-calc" id="calcBtn">üîÆ MANAO CALCUL</button>
        <button class="btn btn-save" id="saveBtn">üíæ MITAHIRY</button>
    </div>

    <!-- R√âSULTAT PR√âDICTION -->
    <div class="prediction-block" id="predictionBlock">
        <div class="prediction-label">VINAVINA HO AN'NY TOUR MANARAKA</div>
        <div class="prediction-time" id="predictionDisplay">--:--:--</div>
        <div><span class="coeff-large" id="coeffDisplay">--x</span></div>
        <div class="calc-desc" id="calcDetails">‚è≥ Fenoy ny information ary tsindrio calcul</div>
    </div>

    <!-- HISTORIQUE AVEC POSSIBILIT√â DE SUPPRIMER (individuel et tout) -->
    <div class="history-header">
        <h2>üìã TANTARAN'NY VINAVINA</h2>
        <span class="counter-badge" id="historyCounter">0</span>
        <button class="delete-all-btn" id="clearAllBtn">üóëÔ∏è FAFANA REHETRA</button>
    </div>
    <div class="history-grid" id="historyGrid">
        <!-- Les cartes historique seront inject√©es ici -->
    </div>

</div>

<script>
    (function() {
        // ---------- STOCKAGE LOCAL ----------
        const STORAGE_KEY = 'aviator_predictions_sup';
        let predictions = [];

        // Charger ou initialiser avec un exemple
        function loadFromStorage() {
            try {
                const stored = localStorage.getItem(STORAGE_KEY);
                if (stored) {
                    predictions = JSON.parse(stored);
                } else {
                    // Exemple par d√©faut pour que l'historique soit visible
                    predictions = [{
                        hexFirst: 'A',
                        decFirst: '3',
                        tourTime: '14:20',
                        hexLast: 'F',
                        coeff: '12.5',
                        prediction: '14:27:15',
                        savedAt: new Date().toLocaleString('fr-FR')
                    }];
                    saveToStorage();
                }
            } catch (e) {
                predictions = [];
            }
            updateHistoryGrid();
            updateCounter();
        }

        function saveToStorage() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(predictions));
        }

        // ---------- MISE √Ä JOUR DE L'HISTORIQUE (grille) ----------
        function updateHistoryGrid() {
            const grid = document.getElementById('historyGrid');
            if (!grid) return;
            grid.innerHTML = '';
            if (predictions.length === 0) {
                grid.innerHTML = '<div style="color: #6873a6; padding: 30px; text-align: center; width:100%;">‚è≥ Tsy misy prediction voatahiry</div>';
                return;
            }

            // Afficher les plus r√©centes en premier (on suppose que le dernier ajout est push√© au d√©but)
            predictions.slice(0, 40).forEach((p, index) => {
                // Note: on utilise l'index r√©el pour identifier l'√©l√©ment unique, mais attention si plusieurs ont m√™mes donn√©es
                // On pr√©f√®re utiliser un id unique ou l'index dans le tableau global. Mais splice fonctionne avec l'index courant.
                // Pour plus de fiabilit√©, on va stocker un timestamp unique, mais on va simplement utiliser l'index r√©el dans predictions.
                // Probl√®me: si on supprime, les index changent. On va plut√¥t passer l'index du tableau au moment du clic.
                const card = document.createElement('div');
                card.className = 'history-card';
                // On stocke l'index r√©el dans un attribut data-index
                card.setAttribute('data-pred-index', index);
                card.innerHTML = `
                    <div class="pred-hour">‚è∞ ${p.prediction || '--:--:--'}</div>
                    <div class="history-detail">
                        <span>üî∑ ${p.hexFirst || ''} / ${p.decFirst || ''}</span>
                        <span>‚è±Ô∏è ${p.tourTime || ''}</span>
                        <span>üé≤ ${p.hexLast || ''}</span>
                    </div>
                    <div class="history-coeff">${p.coeff || '?'}x</div>
                    <div class="history-date">${p.savedAt || ''}</div>
                    <button class="delete-one" title="Fafana ity prediction ity">‚úï</button>
                `;
                // Ajouter l'√©v√©nement pour le bouton supprimer individuel
                const delBtn = card.querySelector('.delete-one');
                delBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const idx = card.getAttribute('data-pred-index');
                    if (idx !== null) {
                        deleteSinglePrediction(parseInt(idx));
                    }
                });
                grid.appendChild(card);
            });
        }

        function updateCounter() {
            document.getElementById('historyCounter').textContent = predictions.length;
        }

        // ---------- SUPPRIMER UN SEUL √âL√âMENT ----------
        function deleteSinglePrediction(index) {
            if (index >= 0 && index < predictions.length) {
                predictions.splice(index, 1);
                saveToStorage();
                updateHistoryGrid();
                updateCounter();
            }
        }

        // ---------- SUPPRIMER TOUT L'HISTORIQUE ----------
        function clearAllHistory() {
            if (predictions.length === 0) return;
            if (confirm('‚ö†Ô∏è Ho foanana ny historique rehetra? Tsy azo averina.')) {
                predictions = [];
                saveToStorage();
                updateHistoryGrid();
                updateCounter();
            }
        }

        // ---------- CALCUL DE PR√âDICTION ----------
        let lastCalculated = null;  // pour sauvegarde

        function computePrediction() {
            const hexFirst = document.getElementById('hexFirst').value.trim();
            const decFirst = document.getElementById('decFirst').value.trim();
            const tourTime = document.getElementById('tourTime').value.trim();
            const hexLast = document.getElementById('hexLast').value.trim();
            const coeff = document.getElementById('coeff').value.trim();

            if (!hexFirst || !decFirst || !tourTime || !hexLast) {
                alert('‚ö†Ô∏è FENOY ALOHA NY INFO REHETRA!');
                return;
            }

            // validation heure
            const timeRegex = /^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/;
            if (!timeRegex.test(tourTime)) {
                alert('‚è∞ Format heure tsy mety. Ampiasao HH:MM (oh: 09:30)');
                return;
            }

            let hx, dc, lastHx;
            try {
                hx = parseInt(hexFirst, 16);
                dc = parseInt(decFirst, 10);
                lastHx = parseInt(hexLast, 16);
                if (isNaN(hx) || isNaN(dc) || isNaN(lastHx)) throw new Error();
            } catch {
                alert('‚ùå Ny HEX sy DEC dia tsy maintsy isa marina (hex 0-9A-F, dec 0-9)');
                return;
            }

            const diffMin = hx - dc;

            const [hh, mm] = tourTime.split(':').map(Number);
            const base = new Date();
            base.setHours(hh, mm, 0, 0);
            base.setMinutes(base.getMinutes() + diffMin);
            base.setSeconds(lastHx);

            const predH = base.getHours().toString().padStart(2,'0');
            const predM = base.getMinutes().toString().padStart(2,'0');
            const predS = base.getSeconds().toString().padStart(2,'0');
            const predStr = `${predH}:${predM}:${predS}`;

            // Affichage
            document.getElementById('predictionDisplay').textContent = predStr;
            document.getElementById('coeffDisplay').textContent = coeff ? `${coeff}x` : '--x';

            const detail = `üîé Kajy: ${hexFirst} - ${decFirst} = ${diffMin} min ¬∑ ${tourTime} + ${diffMin} = ${predH}:${predM} ¬∑ segondra = ${lastHx}`;
            document.getElementById('calcDetails').innerHTML = detail;

            // Animation
            const block = document.getElementById('predictionBlock');
            block.style.transform = 'scale(1.01)';
            setTimeout(() => block.style.transform = 'scale(1)', 120);

            // Stocker pour sauvegarde
            lastCalculated = {
                hexFirst, decFirst, tourTime, hexLast, coeff: coeff || '?',
                prediction: predStr,
                savedAt: new Date().toLocaleString('fr-FR')
            };
        }

        // ---------- SAUVEGARDER LA PR√âDICTION ----------
        function savePrediction() {
            if (!lastCalculated) {
                alert('‚ö†Ô∏è ALOHA ATAO NY CALCUL VOA ALOHA NY MITAHIRY!');
                return;
            }
            // Ajouter au d√©but du tableau (plus r√©cent en premier)
            predictions.unshift({ ...lastCalculated });
            saveToStorage();
            updateHistoryGrid();
            updateCounter();
            alert('‚úÖ TAFITA NY FITAHIRIZANA!');
        }

        // ---------- INITIALISATION ----------
        window.addEventListener('load', function() {
            loadFromStorage();

            document.getElementById('calcBtn').addEventListener('click', computePrediction);
            document.getElementById('saveBtn').addEventListener('click', savePrediction);
            document.getElementById('clearAllBtn').addEventListener('click', clearAllHistory);

            // Enter dans un champ d√©clenche le calcul
            document.querySelectorAll('input').forEach(inp => {
                inp.addEventListener('keypress', e => { if (e.key === 'Enter') computePrediction(); });
            });

            // Si l'historique est vide, on ajoute un exemple (d√©j√† fait dans loadFromStorage)
        });
    })();
</script>
</body>
</html>
